<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Organuhr</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #f0f0f0;
      }
      h1 {
        color: #333;
      }
      #info {
        margin-bottom: 20px;
      }
      #currentTime,
      #currentOrgan {
        font-size: 1.2em;
        margin: 5px 0;
      }
      canvas {
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 50%;
        max-width: 90vw;
        max-height: 90vh;
      }
    </style>
  </head>
  <body>
    <h1>Organuhr</h1>
    <div id="info">
      <div id="currentTime"></div>
      <div id="currentOrgan"></div>
    </div>
    <canvas id="clockCanvas"></canvas>

    <script>
      const organSegments = [
        {
          name: "Gallenblase",
          startTime: "23:00",
          endTime: "01:00",
          element: "Holz",
          meridian: "yang",
          funktion: "Verteilung, Speicherung",
          jahreszeit: "Fruehling",
          klima: "Wind",
          farbe: "Gruen, Blaugruen",
          koerpergewebe: "Muskeln, Sehnen",
          koerperfluessigkeit: "Tränen",
          sinnesorgan: "Augen",
          geschmack: "sauer",
        },
        {
          name: "Leber",
          startTime: "01:00",
          endTime: "03:00",
          element: "Holz",
          meridian: "yin",
          funktion: "Verteilung, Speicherung",
          jahreszeit: "Fruehling",
          klima: "Wind",
          farbe: "Gruen, Blaugruen",
          koerpergewebe: "Muskeln, Sehnen",
          koerperfluessigkeit: "Tränen",
          sinnesorgan: "Augen",
          geschmack: "sauer",
        },
        {
          name: "Lunge",
          startTime: "03:00",
          endTime: "05:00",
          element: "Metall",
          meridian: "yin",
          funktion: "Austausch",
          jahreszeit: "Herbst",
          klima: "Trockenheit",
          farbe: "Silber, Grau, Weiß",
          koerpergewebe: "Haut, Nerven",
          koerperfluessigkeit: "Schleim, Lymphe",
          sinnesorgan: "Nase",
          geschmack: "scharf",
        },
        {
          name: "Dickdarm",
          startTime: "05:00",
          endTime: "07:00",
          element: "Metall",
          meridian: "yang",
          funktion: "Austausch",
          jahreszeit: "Herbst",
          klima: "Trockenheit",
          farbe: "Silber, Grau, Weiß",
          koerpergewebe: "Haut, Nerven",
          koerperfluessigkeit: "Schleim, Lymphe",
          sinnesorgan: "Nase",
          geschmack: "scharf",
        },
        {
          name: "Magen",
          startTime: "07:00",
          endTime: "09:00",
          element: "Erde",
          meridian: "yang",
          funktion: "Verdauung, Säfte",
          jahreszeit: "Spätsommer",
          klima: "Feuchtigkeit",
          farbe: "Gelb, Orange",
          koerpergewebe: "Bindegewebe",
          koerperfluessigkeit: "Speichel, Schleim",
          sinnesorgan: "Mund",
          geschmack: "sueß",
        },
        {
          name: "Milz",
          startTime: "09:00",
          endTime: "11:00",
          element: "Erde",
          meridian: "yin",
          funktion: "Verdauung, Säfte",
          jahreszeit: "Spätsommer",
          klima: "Feuchtigkeit",
          farbe: "Gelb, Orange",
          koerpergewebe: "Bindegewebe",
          koerperfluessigkeit: "Speichel, Schleim",
          sinnesorgan: "Mund",
          geschmack: "sueß",
        },
        {
          name: "Herz",
          startTime: "11:00",
          endTime: "13:00",
          element: "Feuer",
          meridian: "yin",
          funktion: "Aufnehmen, Umwandeln",
          jahreszeit: "Sommer",
          klima: "Hitze",
          farbe: "Rot",
          koerpergewebe: "Blutgefäße",
          koerperflssigkeit: "Blut, Schweiß",
          sinnesorgan: "Zunge",
          geschmack: "bitter",
        },
        {
          name: "Duenndarm",
          startTime: "13:00",
          endTime: "15:00",
          element: "Feuer",
          meridian: "yang",
          funktion: "Aufnehmen, Umwandeln",
          jahreszeit: "Sommer",
          klima: "Hitze",
          farbe: "Rot",
          koerpergewebe: "Blutgefäße",
          koerperfluessigkeit: "Blut, Schweiß",
          sinnesorgan: "Zunge",
          geschmack: "bitter",
        },
        {
          name: "Blase",
          startTime: "15:00",
          endTime: "17:00",
          element: "Wasser",
          meridian: "yang",
          funktion: "Reinigung",
          jahreszeit: "Winter",
          klima: "Kälte",
          farbe: "Blau, Schwarz",
          koerpergewebe: "Knochen, Gelenke",
          koerperfluessigkeit: "Urin",
          sinnesorgan: "Ohren",
          geschmack: "salzig",
        },
        {
          name: "Niere",
          startTime: "17:00",
          endTime: "19:00",
          element: "Wasser",
          meridian: "yin",
          funktion: "Reinigung",
          jahreszeit: "Winter",
          klima: "Kälte",
          farbe: "Blau, Schwarz",
          koerpergewebe: "Knochen, Gelenke",
          koerperfluessigkeit: "Urin",
          sinnesorgan: "Ohren",
          geschmack: "salzig",
        },
        {
          name: "Perikard",
          startTime: "19:00",
          endTime: "21:00",
          element: "Feuer",
          meridian: "yin",
          funktion: "Aufnehmen, Umwandeln",
          jahreszeit: "Sommer",
          klima: "Hitze",
          farbe: "Rot",
          koerpergewebe: "Blutgefäße",
          koerperfluessigkeit: "Blut, Schweiß",
          sinnesorgan: "Zunge",
          geschmack: "bitter",
        },
        {
          name: "Dreifacher-Erwärmer",
          startTime: "21:00",
          endTime: "23:00",
          element: "Feuer",
          meridian: "yang",
          funktion: "Aufnehmen, Umwandeln",
          jahreszeit: "Sommer",
          klima: "Hitze",
          farbe: "Rot",
          koerpergewebe: "Blutgefäße",
          koerperfluessigkeit: "Blut, Schweiß",
          sinnesorgan: "Zunge",
          geschmack: "bitter",
        },
      ];

      // Add the elementColors constant near the top of your script.
      const elementColors = {
        Holz: "#90EE90", // Light Green
        Metall: "#D3D3D3", // Light Grey
        Erde: "#DEB887", // Light Brown
        Feuer: "#FFA07A", // Light Red
        Wasser: "#ADD8E6", // Light Blue
      };

      // Update getCurrentSegmentIndex (remains unchanged if you wish to keep the 2-hour slot logic).
      function getCurrentSegmentIndex() {
        const hour = new Date().getHours();
        return Math.floor((hour + 1) / 2) % 12;
      }

      // Update getCurrentOrgan to use the new constant.
      function getCurrentOrgan() {
        return organSegments[getCurrentSegmentIndex()].name;
      }

      // Update current time display.
      function updateCurrentTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        document.getElementById("currentTime").textContent =
          "Zeit: " + timeString;
      }

      // Update current organ display.
      function updateCurrentOrgan() {
        document.getElementById("currentOrgan").textContent =
          "Aktuelles Organ: " + getCurrentOrgan();
      }

      // Resize canvas to be responsive.
      function resizeCanvas() {
        const canvas = document.getElementById("clockCanvas");
        // Use 80% of the smaller window dimension.
        const size = Math.min(window.innerWidth, window.innerHeight) * 0.8;
        canvas.width = size;
        canvas.height = size;
      }

      // Draw the circular organ clock.
      function drawClock() {
        const canvas = document.getElementById("clockCanvas");
        if (!canvas.getContext) return;
        const ctx = canvas.getContext("2d");
        const width = canvas.width;
        const height = canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = Math.min(centerX, centerY) - 10; // Padding

        // Clear canvas.
        ctx.clearRect(0, 0, width, height);

        // Each segment covers 30° (2π/12).
        const segmentAngle = (2 * Math.PI) / 12;
        // Offset so that 23:00 is at the top.
        const offset = -Math.PI / 2 - segmentAngle / 2;
        const currentIndex = getCurrentSegmentIndex();

        // Draw each segment.
        for (let i = 0; i < 12; i++) {
          const startAngle = offset + i * segmentAngle;
          const endAngle = startAngle + segmentAngle;

          // Fill segment based on its element.
          ctx.fillStyle = elementColors[organSegments[i].element] || "#d0e1f9";
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, startAngle, endAngle);
          ctx.closePath();
          ctx.fill();

          // Draw segment border.
          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 2;
          ctx.stroke();

          // Calculate the midpoint angle for text placement.
          const midAngle = startAngle + segmentAngle / 2;
          // Position for the text at 70% of the radius.
          const textRadius = radius * 0.7;
          const textX = centerX + textRadius * Math.cos(midAngle);
          const textY = centerY + textRadius * Math.sin(midAngle);

          // Save context state to rotate text.
          ctx.save();
          ctx.translate(textX, textY);

          // Calculate text rotation so that it appears radial and upright.
          let textRotation = midAngle + Math.PI / 2;
          if (textRotation > Math.PI / 2 && textRotation < (3 * Math.PI) / 2) {
            textRotation += Math.PI;
          }
          ctx.rotate(textRotation);

          // Set text styles.
          ctx.fillStyle = "#333";
          ctx.font = "bold 12px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "bottom";
          ctx.fillText(organSegments[i].name, 0, -2);
          ctx.font = "10px Arial";
          ctx.textBaseline = "top";
          ctx.fillText(
            organSegments[i].startTime + " - " + organSegments[i].endTime,
            0,
            2
          );
          ctx.restore();
        }

        // Draw the outer circle.
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 3;
        ctx.stroke();

        // Draw a small center circle.
        ctx.beginPath();
        ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "#333";
        ctx.fill();

        // Draw the current time marker (similar to an hour hand, but continuous).
        const now = new Date();
        // Calculate hour plus fraction from minutes.
        const hour = now.getHours(); // 24
        const minutes = now.getMinutes(); // 60
        const fraction = minutes / 60;
        const markerAngle =
          offset + (hour + 1 + fraction) * ((2 * Math.PI) / 24);

        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        // Draw the marker to 90% of the radius.
        ctx.lineTo(
          centerX + radius * 0.9 * Math.cos(markerAngle),
          centerY + radius * 0.9 * Math.sin(markerAngle)
        );
        ctx.strokeStyle = "#e74c3c"; // A red marker.
        ctx.lineWidth = 4;
        ctx.stroke();
      }

      // Main update function.
      function updateOrganClock() {
        updateCurrentTime();
        updateCurrentOrgan();
        drawClock();
      }

      // Initialize on page load.
      function init() {
        resizeCanvas();
        updateOrganClock();
        // Update the display every second.
        setInterval(updateOrganClock, 1000);
      }

      // Resize canvas when window is resized.
      window.addEventListener("resize", () => {
        resizeCanvas();
        updateOrganClock();
      });

      window.onload = init;
    </script>
  </body>
</html>
